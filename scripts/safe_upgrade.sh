#!/bin/bash
# ุชุฑููุฉ ุขููุฉ ูููุตูุน

set -e

BASE_DIR="/root/hyper-factory"
BACKUP_DIR="$BASE_DIR/backups/$(date +%Y%m%d_%H%M%S)"

echo "๐ก๏ธ  ุจุฏุก ุงูุชุฑููุฉ ุงูุขููุฉ..."

# ูุณุฎ ุงุญุชูุงุทู
mkdir -p "$BACKUP_DIR"
cp -r "$BASE_DIR/apps" "$BASE_DIR/scripts" "$BACKUP_DIR/" 2>/dev/null || true
echo "โ ูุณุฎ ุงุญุชูุงุทู ูู: $BACKUP_DIR"

# ูุญุต ุงูุตุญุฉ ูุจู ุงูุชุฑููุฉ
if ! curl -s http://localhost:9090/api/health > /dev/null; then
    echo "โ ุงููุธุงู ุบูุฑ ูุณุชูุฑ - ุฅูุบุงุก ุงูุชุฑููุฉ"
    exit 1
fi

echo "โ ุงููุธุงู ูุณุชูุฑ - ูููู ุงููุชุงุจุนุฉ"
echo "๐ ุฎุทูุงุช ุงูุชุฑููุฉ:"
echo "1. git pull (ุฅุฐุง ูุงู ููุงู ุชุญุฏูุซุงุช)"
echo "2. ุงุฎุชุจุงุฑ ูู ุจูุฆุฉ ููุนุฒูุฉ"  
echo "3. ุชุทุจูู ุนูู Production"
echo "4. ูุญุต ุตุญุฉ ุงููุธุงู"

# ููุง ูููู ุฅุถุงูุฉ ุฎุทูุงุช ุงูุชุฑููุฉ ุงููุญุฏุฏุฉ
echo "๐ฏ ุชู ุฅุนุฏุงุฏ ุงูุชุฑููุฉ ุงูุขููุฉ"
